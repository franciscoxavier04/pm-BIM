# frozen_string_literal: true

# -- copyright
# OpenProject is an open source project management software.
# Copyright (C) the OpenProject GmbH
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License version 3.
#
# OpenProject is a fork of ChiliProject, which is a fork of Redmine. The copyright follows:
# Copyright (C) 2006-2013 Jean-Philippe Lang
# Copyright (C) 2010-2013 the ChiliProject Team
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation; either version 2
# of the License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.
#
# See COPYRIGHT and LICENSE files for more details.
# ++

Dir[Rails.root.join("db/migrate/tables/*.rb").to_s].each { |file| require file }
Dir[Rails.root.join("db/migrate/extensions/*.rb").to_s].each { |file| require file }
require Rails.root.join("db/migrate/migration_utils/squashed_migration").to_s

# This migration aggregates a set of former migrations
class AggregatedMigrations < SquashedMigration
  extensions Extensions::BtreeGist,
             Extensions::PgTrgm,
             Extensions::Unaccent,
             Extensions::VersionNameCollation

  tables Tables::Projects,
         Tables::Colors,
         Tables::Types,
         Tables::Statuses,
         Tables::WorkPackages,
         Tables::Users,
         Tables::GroupUsers,
         Tables::Categories,
         Tables::Relations,
         Tables::WorkPackageHierarchies,
         Tables::Sessions,
         Tables::Announcements,
         Tables::Attachments,
         Tables::LdapAuthSources,
         Tables::Forums,
         Tables::Messages,
         Tables::CustomFieldSections,
         Tables::CustomFields,
         Tables::CustomFieldsProjects,
         Tables::CustomFieldsTypes,
         Tables::CustomOptions,
         Tables::CustomValues,
         Tables::Changesets,
         Tables::ChangesetsWorkPackages,
         Tables::Journals,
         Tables::WorkPackageJournals,
         Tables::ProjectJournals,
         Tables::MessageJournals,
         Tables::NewsJournals,
         Tables::WikiPageJournals,
         Tables::ChangesetJournals,
         Tables::AttachmentJournals,
         Tables::AttachableJournals,
         Tables::CustomizableJournals,
         Tables::Comments,
         Tables::Changes,
         Tables::Repositories,
         Tables::Enumerations,
         Tables::Roles,
         Tables::RolePermissions,
         Tables::MemberRoles,
         Tables::Members,
         Tables::News,
         Tables::ProjectsTypes,
         Tables::Queries,
         Tables::Settings,
         Tables::Tokens,
         Tables::UserPreferences,
         Tables::UserPasswords,
         Tables::Versions,
         Tables::Watchers,
         Tables::WikiPages,
         Tables::WikiRedirects,
         Tables::Wikis,
         Tables::Workflows,
         Tables::Exports,
         Tables::MenuItems,
         Tables::CustomStyles,
         Tables::DesignColors,
         Tables::EnterpriseTokens,
         Tables::EnabledModules,
         Tables::AttributeHelpTexts,
         Tables::CustomActions,
         Tables::CustomActionsProjects,
         Tables::CustomActionsRoles,
         Tables::CustomActionsStatuses,
         Tables::CustomActionsTypes,
         Tables::OAuthApplications,
         Tables::OAuthAccessGrants,
         Tables::OAuthAccessTokens,
         Tables::OrderedWorkPackages,
         Tables::Notifications,
         Tables::NotificationSettings,
         Tables::Views,
         Tables::OAuthClients,
         Tables::OAuthClientTokens,
         Tables::NonWorkingDays,
         Tables::PaperTrailAudits,
         Tables::ProjectCustomFieldProjectMappings,
         Tables::ProjectQueries,
         Tables::GoodJobs,
         Tables::GoodJobProcesses,
         Tables::GoodJobSettings,
         Tables::GoodJobBatches,
         Tables::GoodJobExecutions,
         Tables::Favorites,
         Tables::EmojiReactions,
         Tables::AuthProviders,
         Tables::RemoteIdentities,
         Tables::HierarchicalItems,
         Tables::HierarchicalItemHierarchies

  # rubocop:disable Metrics/CollectionLiteralLength
  squashed_migrations *%w[
    10000000000000_to_v710_aggregated_migrations
    20100528100562_aggregated_global_roles_migrations
    20170703075208_add_attribute_help_texts
    20170705134348_remove_attribute_visibility
    20170818063404_add_timeline_labels_to_query
    20170829095701_generate_wp_closure
    20171106074835_move_hashed_token_to_core
    20171129145631_add_fulltext_to_attachments
    20180105130053_rebuild_dag
    20180108132929_vacuum_relations
    20180116065518_add_hierarchy_paths
    20190301122554_remove_hierarchy_paths
    20180117065255_remove_timelines_and_reportings
    20180122135443_add_tsv_columns_to_attachments
    20180123092002_add_custom_actions
    20180213155320_add_description_to_custom_actions
    20180221151038_add_position_to_custom_action
    20180305130811_remove_wiki_content_versions
    20180419061910_timestamp_for_caching
    20180504144320_add_color_to_statuses_and_enumerations
    20180510184732_rename_planning_elemnt_type_colors_to_colors
    20180518130559_add_timestamps_to_wiki
    20180524084654_remove_non_null_container_on_attachments
    20180524113516_add_consent_timestamp_to_user
    20180706150714_convert_to_markdown
    20180717102331_remove_in_aggregation_from_type
    20180801072018_remove_responsible_and_type_from_project
    20180830120550_migrate_light_background_themes
    20180903110212_add_highlighting_to_query
    20180924141838_add_highlighted_attributes_to_query
    20181101132712_add_read_only_to_statuses
    20181112125034_create_doorkeeper_tables
    20181121174153_create_ordered_work_packages
    20190124081710_remove_accessibility_mode
    20190207155607_add_hidden_to_queries
    20190227163226_add_tls_mode_to_auth_sources
    20190312083304_rename_boards_to_forums
    20190411122815_set_timeline_auto_zoom
    20190502102512_ensure_postgres_index_names
    20190507132517_add_board_view_to_roles
    20190509071101_add_default_description_to_types
    20190527095959_set_manage_board_permission
    20190603060951_set_assign_versions_permission
    20190618115620_fix_available_languages
    20190619143049_add_timestamps_to_query
    20190716071941_add_display_representation_to_query
    20190722082648_add_derived_estimated_hours_to_work_packages
    20190724093332_add_journal_versions_table
    20190920102446_clean_custom_values
    20190923111902_add_project_status_reporting
    20190923123858_simplify_project_active_and_timestamp
    20191106132533_make_system_user_active
    20191112111040_fix_system_user_status
    20191115141154_add_content_orientation_to_custom_fields
    20191216135213_join_table_for_active_activities
    20200114091135_add_theme_name_to_custom_styles
    20200115090742_fix_parent_id_for_wiki_pages
    20200206101135_add_theme_logo_to_custom_style
    20200217061622_add_timestamp_to_news
    20200217155632_rename_tokens
    20200220171133_rename_bim_module
    20200302100431_fix_attachable_journals
    20200325101528_strip_whitespace_from_user_attributes
    20200326102408_rename_fixed_version
    20200403105252_add_cron_to_delayed_jobs
    20200415131633_add_work_package_exports
    20200427121606_add_filter_to_ldap
    20200428105404_unique_member_role
    20200504085933_add_schedule_manually_to_work_packages
    20200522131255_splash_multi_list_customizable_journals
    20200522140244_remove_journal_versions_table
    20200527130633_add_templated_to_project
    20200625133727_fix_inherited_group_member_roles
    20200708065116_fix_members_inconsistencies
    20200803081038_journalize_scheduling_mode
    20200820140526_remove_summable_setting
    20200903064009_enable_current_project_custom_fields_columns
    20200907090753_change_attachment_filesize_to_big_int
    20200914092212_set_current_timestamp_defaults_for_bcf_viewpoints_and_issues
    20200924085508_cleanup_orphaned_journal_data
    20200925084550_members_allow_null_on_project
    20201005120137_ensure_integer_for_relations_foreign_keys
    20201005184411_rename_timestamps
    20201125121949_remove_renamed_cron_job
    20210221230446_add_group_user_primary_key
    20210126112238_add_uniqueness_constrain_on_lastname_for_groups_and_placeholder_users
    20210127134438_alter_user_attributes_max_length.rb
    20210214205545_replace_invalid_principal_references
    20210310101840_generalize_exports
    20210331085058_migrate_sessions_unlogged
    20210427065703_make_system_user_admin
    20210510193438_remove_project_setting
    20210512121322_make_project_identifier_unique
    20210519141244_remove_reply_from_message_journalizing
    20210616145324_polymorphic_journal_data
    20210616191052_create_notifications
    20210618125430_authors_as_watchers
    20210618132206_add_notification_settings
    20210628185054_extend_custom_field_name_length
    20210701073944_add_digest_setting
    20210701082511_add_digest_to_notification
    20210726070813_remove_journal_versions
    20210802114054_add_notification_setting_options
    20210825183540_make_user_preferences_json
    20210902201126_cleanup_user_preferences
    20210914065555_cleanup_notifications
    20210915154656_add_user_preference_settings_indices
    20210917190141_non_work_package_notification_settings
    20210922123908_notification_foreign_key_constraint
    20210928133538_add_reminder_workdays
    20211005080304_tzinfo_time_zones
    20211005135637_remove_invalid_group_users
    20211026061420_add_indexes_for_email_reminder_pause
    20211101152840_redistribute_edit_project_permission
    20211102161932_remove_custom_field_types
    20211103120946_clean_emails_footer
    20211104151329_default_notification_setting
    20211117195121_remove_destroyed_help_texts
    20211118203332_clean_hide_mail
    20211130161501_add_views
    20211209092519_query_views
    20220106145037_fix_missing_notification_settings
    20220202140507_reorder_project_children
    20220223095355_projects_lft_rgt_index
    20220302123642_assignable_to_permission
    20220319211253_add_parent_id_to_wp
    20220323083000_add_include_subprojects_to_query
    20220414085531_migrate_team_planner_permissions
    20220428071221_restore_defaults_on_empty_settings
    20220426132637_refix_inherited_group_member_roles
    20220408080838_bigint_primary_key_on_relations
    20220503093844_create_oauth_client
    20220511124930_create_week_days
    20220517113828_create_non_working_days
    20220518154147_create_oauth_client_tokens
    20220525154549_add_duration_to_work_packages
    20220614132200_add_ignore_non_working_days_to_work_packages
    20220615213015_migrate_log_time_to_log_own_time_in_role_permissions
    20220620132922_change_duration_default_value
    20220622151721_drop_project_associations
    20220629061540_add_paper_trail
    20220629073727_add_polymorphic_integration_to_oauth_application
    20220712132505_add_foreign_key_constraint_for_type_color_id
    20220714145356_migrate_work_package_export_settings
    20220804112533_remove_notification_cleanup_job
    20220811061024_rename_work_package_export_limit
    20220817154403_remove_work_packages_duration_field_active_setting
    20220818074150_fix_invalid_journals
    20220818074159_fix_deleted_data_journals
    20220830074821_add_ignore_non_working_days_to_work_package_journals
    20220830092057_change_default_for_non_working_days
    20220831073113_work_package_project_foreign_key
    20220831081937_migrate_timestamps_to_with_timezone
    20220909153412_drop_week_days
    20220911182835_create_default_working_days_setting_entry
    20220918165443_add_start_date_due_date_and_overdue_to_notification_settings
    20220922200908_split_involved_notification_setting
    20220926124435_constrain_work_package_dates
    20220929114423_add_unique_index_to_ldap_groups_membership
    20220930133418_set_duration_for_milestone_work_packages
    20221017073431_remove_orphaned_tokens
    20221017184204_change_defaults_for_notification_settings
    20221026132134_bigint_primary_and_foreign_keys
    20221028070534_change_notification_settings_start_date_due_date_and_overdue_duration_unit_to_days
    20221027151959_remove_plaintext_tokens
    20221029194419_add_timestamps_to_queries
    20221115082403_add_ldap_tls_options
    20221129074635_remove_activity_type_from_journals_table
    20221130150352_create_project_journals
    20221201140825_add_non_null_constraint_on_projects_identifier
    20221202130039_fill_project_journals_with_existing_data
    20221213092910_remove_default_values_from_journal_tables_definition
    20230508150835_copy_project_status_into_projects_and_journals
    20230105073117_remove_renamed_date_alert_job
    20230105134940_work_package_date_indices
    20230130134630_add_index_for_work_package_journals_project_id
    20230306083203_non_null_data_reference_on_journals
    20230309104056_unique_index_on_custom_fields_projects
    20230314093106_add_update_delete_cascade_to_work_packages_project_id
    20230314165213_add_foreign_keys_to_work_packages
    20230315103437_add_foreign_keys_to_workflows
    20230315183431_add_foreign_keys_to_projects_types
    20230315184533_add_foreign_keys_to_custom_fields_projects
    20230322135932_merge_wiki_content_into_page
    20230328154645_add_gin_trgm_index_on_journals_and_custom_values
    20230531093004_remove_default_from_query_name
    20230606083221_add_cause_to_journal
    20230608151123_add_validity_period_to_journals
    20230613155001_add_export_logo_to_custom_style
    20230718084649_add_create_user_permission_to_roles
    20230726061920_rename_auth_source_to_ldap_auth_source
    20230726112130_remove_type_from_ldap_auth_sources
    20230803113215_add_indices_to_work_package_journals
    20230808080001_remove_some_string_length_constraints
    20230808140921_add_derived_remaining_hours_to_work_packages
    20230810074642_add_optional_entity_to_members
    20230829151629_add_copy_work_packages_permission_to_roles
    20230905090205_add_share_workpackages_permission
    20230905126002_add_export_cover_to_custom_style
    20230911093530_remove_news_journals_title_length_constraint
    20230912185647_add_view_shared_work_packages_permission
    20231002141527_fix_default_language_value_for_chinese_simplified
    20231005113307_role_to_project_role
    20231017093339_add_allow_non_open_versions_to_custom_fields
    20231024150429_add_shared_to_notification_settings
    20231026111049_add_public_permissions_to_project_roles
    20231027102747_rollback_create_meeting_agendas_and_split_edit_meeting_role
    20231031133334_create_project_custom_field_project_mappings
    20231105194747_add_data_to_tokens
    20231123111357_create_custom_field_sections
    20231128080650_add_work_package_roles
    20231205143648_add_add_work_package_attachment_permission_to_commenters
    20231212131603_set_custom_fields_filter_default_true
    20231227100753_fix_derived_work_and_remaining_work_values
    20240104172050_add_project_queries
    20240115112549_fix_spent_time_widget_identifier
    20240116165933_add_derived_done_ratio_to_work_packages
    20240123151246_create_good_jobs
    20240123151247_create_good_job_settings
    20240123151248_create_index_good_jobs_jobs_on_priority_created_at_when_unfinished
    20240123151249_create_good_job_batches
    20240123151250_create_good_job_executions
    20240123151251_create_good_jobs_error_event
    20240123151252_recreate_good_job_cron_indexes_with_conditional
    20240131130134_fix_inherited_group_memberships
    20240206173841_fix_untranslated_work_package_roles
    20240207075946_add_status_to_attachment
    20240208100316_enable_required_project_custom_fields_in_all_projects
    20240222155909_rename_columns_on_project_queries
    20240227154544_remove_delayed_jobs
    20240306083241_change_default_value_of_alternative_color
    20240306154734_create_good_job_labels
    20240306154735_create_good_job_labels_index
    20240306154736_remove_good_job_active_id_index
    20240306154737_create_index_good_job_jobs_for_candidate_lookup
    20240206085104_remove_enums
    20240307094432_change_done_ratio_default_value_to_null
    20240307102541_reduce_configurable_design_variables
    20240307190126_rename_portuguese_locale
    20240311111957_enable_unaccent_extension
    20240325150312_change_derived_done_ratio_default_value_to_null
    20240328154805_change_status_default_done_ratio_to_zero
    20240402065214_remove_ldap_tls_setting
    20240402072213_update_progress_calculation
    20240404074025_create_favorite
    20240408093541_change_default_accent_and_bim_primary_color
    20240422141623_rename_estimate_and_time_attribute_group
    20240424093311_add_excluded_from_totals_to_statuses
    20240424160513_add_settings_to_projects
    20240430143313_update_default_project_columns
    20240506091102_remove_totals_from_childless_work_packages
    20240513135928_extend_oauth_applications
    20240519123921_add_public_to_project_queries
    20240522073759_fix_status_excluded_from_totals_changed_journal_cause
    20240527070439_add_project_query_roles
    20240611105232_set_watched_notification_setting_to_true
    20240624103354_create_emoji_reactions
    20240625075139_add_uniqueness_index_to_project_custom_field_project_mappings
    20240703131639_add_timestamps_to_user_preferences
    20240715183144_add_indexes_to_custom_options
    20240801105918_add_auth_providers
    20240805104004_rename_visible_to_admin_only_in_custom_fields
    20240806144333_create_remote_identities
    20240808125617_populate_remote_identities
    20240808133947_add_lock_version_to_oauth_client_tokens
    20240813131647_drop_origin_user_id_from_oauth_client_tokens
    20240820123011_remove_project_from_notification
    20240909151818_migrate_legacy_default_theme_to_light_theme
    20240920152544_set_versions_name_collation
    20240924114246_create_hierarchical_items
    20240408132459_rename_delay_to_lag
    20240410060041_remove_virtual_delay_column
    20240620115412_add_project_attribute_roles
    20240917105829_add_primary_key_to_custom_fields_projects
    20241001205821_add_standard_global_role
    20241002151949_remove_hide_mail_from_user_preferences
    20241015081341_remove_obsolete_design_variables
  ]
  # rubocop:enable Metrics/CollectionLiteralLength
end
