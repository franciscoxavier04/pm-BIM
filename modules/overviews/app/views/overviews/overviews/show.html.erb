<%=
  render(Primer::OpenProject::PageHeader.new) do |header|
    header.with_title(variant: :medium) { t("overviews.label") }
    header.with_breadcrumbs(
      [
        { href: project_path(@project), text: @project.name, skip_for_mobile: true },
        t("overviews.label")
      ]
    )
    favored = @project.favored_by?(User.current)
    header.with_action_icon_button(
      icon: favored ? "star-fill" : "star",
      mobile_icon: favored ? "star-fill" : "star",
      size: :medium,
      tag: :a,
      href: build_favorite_path(@project, format: :html),
      data: { method: favored ? :delete : :post },
      classes: favored ? "op-primer--star-icon" : "",
      label: favored ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite),
      aria: { label: favored ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite) },
      test_selector: "project-favorite-button"
    )

    header.with_action_menu(
      menu_arguments: { anchor_align: :end },
      button_arguments: { icon: "kebab-horizontal", "aria-label": t(:label_menu) }
    ) do |menu|
      if User.current.allowed_in_project?(:select_project_custom_fields, @project)
        menu.with_item(
          label: t(:label_project_attribute_manage_link),
          href: project_settings_project_custom_fields_path(@project),
          data: { turbo: false }
        ) do |item|
          item.with_leading_visual_icon(icon: :pencil)
        end
      end

      if User.current.allowed_in_project?(:archive_project, @project)
        menu.with_item(
          label: t(:label_archive_project),
          href: project_archive_path(@project, status: "", name: @project.name),
          content_arguments: {
            data: { method: :post, turbo: false, confirm: t("project.archive.are_you_sure", name: @project.name) }
          }
        ) do |item|
          item.with_leading_visual_icon(icon: :lock)
        end
      end
    end
  end
%>

<%=
  if User.current.allowed_in_project?(:manage_overview, @project)
    render(Primer::OpenProject::SubHeader.new) do |subheader|
      subheader.with_action_button(
        scheme: :primary,
        leading_icon: :plus,
        label: t(:label_widget_new),
        data: {
          controller: "overview--add-widgets",
          action: "click->overview--add-widgets#addWidget"
        },
        test_selector: "overview--add-widgets-button"
      ) do
        t(:label_widget)
      end
    end
  end
%>

<%=
  if @custom_fields_sidebar_enabled || @life_cycle_sidebar_enabled
    render(Primer::Alpha::Layout.new) do |component|
      component.with_main do
        angular_component_tag "opce-overview"
      end

      component.with_sidebar(width: :narrow, col_placement: :end) do
        if @life_cycle_sidebar_enabled
          concat(
            turbo_frame_tag "project-life-cycle-sidebar", src: project_life_cycle_sidebar_path(@project) do
              image_tag("loading_indicator.svg")
            end
          )
        end

        if @custom_fields_sidebar_enabled
          concat(
            turbo_frame_tag "project-custom-fields-sidebar", src: project_custom_fields_sidebar_path(@project) do
              image_tag("loading_indicator.svg")
            end
          )
        end
      end
    end
  else
    angular_component_tag "opce-overview"
  end
%>
