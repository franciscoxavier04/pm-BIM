<% content_for :header_tags do %>
  <meta name="custom_fields_sidebar_enabled" data-enabled="<%= @custom_fields_sidebar_enabled %>">
  <meta name="life_cycle_sidebar_enabled" data-enabled="<%= @life_cycle_sidebar_enabled %>">
<% end -%>

<%=
  render(Primer::OpenProject::PageHeader.new) do |header|
    header.with_title(variant: :medium) { t("overviews.label") }
    header.with_breadcrumbs(
      [
        { href: project_path(@project), text: @project.name, skip_for_mobile: true },
        t("overviews.label")
      ]
    )
    favored = @project.favored_by?(User.current)
    header.with_action_icon_button(
      icon: favored ? "star-fill" : "star",
      mobile_icon: favored ? "star-fill" : "star",
      size: :medium,
      tag: :a,
      href: build_favorite_path(@project, format: :html),
      data: { method: favored ? :delete : :post },
      classes: favored ? "op-primer--star-icon" : "",
      label: favored ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite),
      aria: { label: favored ? I18n.t(:button_unfavorite) : I18n.t(:button_favorite) },
      test_selector: "project-favorite-button"
    )

    header.with_action_menu(
      menu_arguments: { anchor_align: :end },
      button_arguments: { icon: "kebab-horizontal", "aria-label": t(:label_menu) }
    ) do |menu|
      if User.current.allowed_in_project?(:create_meetings, @project)
        menu.with_item(
          label: "Statusbericht-Besprechung erzeugen",
          tag: :a,
          href: polymorphic_path([:new_dialog, @project, :meetings], report: "1"),
          content_arguments: { data: { controller: "async-dialog" } }
        ) do |item|
          item.with_leading_visual_icon(icon: "comment-discussion")
        end
      end

      if User.current.allowed_in_project?(:select_project_custom_fields, @project)
        menu.with_item(
          label: t(:label_project_attribute_manage_link),
          href: project_settings_project_custom_fields_path(@project),
          data: { turbo: false }
        ) do |item|
          item.with_leading_visual_icon(icon: :pencil)
        end
      end

      if User.current.allowed_in_project?(:archive_project, @project)
        menu.with_item(
          label: t(:label_archive_project),
          href: project_archive_path(@project, status: "", name: @project.name),
          content_arguments: {
            data: { method: :post, turbo: false, confirm: t("project.archive.are_you_sure", name: @project.name) }
          }
        ) do |item|
          item.with_leading_visual_icon(icon: :lock)
        end
      end
    end
  end
%>

<%= render(Primer::Alpha::Layout.new) do |content| %>
  <% content.with_main do %>
    <% if OpenProject::FeatureDecisions.portfolio_dashboard_active? %>
      <%= render(Primer::Alpha::TabPanels.new(label: "label")) do |tab_panel| %>
        <% tab_panel.with_tab(selected: true, id: "tab-selects--overview") do |tab| %>
          <% tab.with_text { "Ãœbersicht" } %>
          <% tab.with_panel do %>
            <%= render Overviews::Portfolios::ShowComponent.new(project: @project) %>
          <% end %>
        <% end %>
        <% tab_panel.with_tab(id: "tab-selects--dashboard") do |tab| %>
          <% tab.with_text { "Dashboard" } %>
          <% tab.with_panel do %>
            <openproject-base></openproject-base>
          <% end %>
        <% end %>
      <% end %>
    <% else %>
      <openproject-base></openproject-base>
    <% end %>
  <% end %>
  <% content.with_sidebar(col_placement: :end, row_placement: :end) do %>
    <% if @project.phases.any? %>
      <turbo-frame
        src="<%= project_life_cycle_sidebar_path(project_id: @project.id) %>"
        id="project-life-cycle-sidebar"
      >
        <op-content-loader viewBox="0 0 100 100">
          <svg:rect x="0" y="0" width="70" height="5" rx="1" />

          <svg:rect x="75" y="0" width="25" height="5" rx="1" />

          <svg:rect x="0" y="10" width="100" height="8" rx="1" />

          <svg:rect x="0" y="25" width="100" height="12" rx="1" />
        </op-content-loader>
      </turbo-frame>
    <% end %>

    <%= render Overviews::Portfolios::SidePanelComponent.new(project: @project) %>
  <% end %>
<% end %>
